# Git Workflow

## Summary

- [introduction](#introduction)
- [Considerations](#considerations)
- [environment-branches](#environment-branches)
- [Git workflow development](#git-workflow-development)
- [Git workflow develop into staging](#git-workflow-develop-into-staging)
- [Git workflow release](#git-workflow-release)

## Introduction

This document describe `Git workflow` to use on this **project**.

## Considerations

- **ALWAYS** Commits should be atomic, a task should have a single commit whenever possible.
- **ALWAYS** if the task has dependencies and requires more than one commit, try to apply a squash commit before
  submitting a pull request for the feature.
- **ALWAYS** after integrating a feature into develop, delete the branch from the remote repository.
- **NEVER** do not make commits for different tasks in the same feature.

## Environment branches

- **Production**: `main` branch
- **Staging**: `staging` branch
- **Development**: `develop` branch

## Git workflow development

This process refers to the development git workflow for new features.

We need to follow the following steps:

1. Go to the **project management platform** and **check** the branch name to create as a **feature** branch. On this
   case the **project management platform** is `Jira` and the **branch name** to get must be the following convention:

```bash
[FEATURE_TYPE]/[PROYECT_CODE]-[TASK_ID]-[TASK-DESCRIPTION]
```

`Feature Type` can be obtained on **feature type** field of `task` details and **branch name** click on `Create branch`
label and take a **unique** branch name for this task.

2. Move into **develop branch** using the following command and update with latest changes from remote repository:

```bash
git checkout develop
```

```bash
git pull origin develop --rebase
```

3. Create a new branch taking as base **develop** using the **feature type** and **branch name** taken from `Jira`:

```bash
git checkout -b [FEATURE_TYPE]/[PROYECT_CODE]-[TASK_ID]-[TASK-DESCRIPTION]
```

4. Work on the **feature** branch until it is complete:

```bash
git add .
```

```bash
git commit -m "featureType: message"
```

**Commit message** must use the format defined in the [Commit convention](./COMMIT_CONVENTION.md) file.

4. Update the feature branch with respect to the develop branch:

```bash
git rebase origin/develop
```

"Or":

```bash
git pull origin develop --rebase
```

5. Push the feature branch to the remote repository:

```bash
git push origin [FEATURE_TYPE]/[PROYECT_CODE]-[TASK_ID]-[TASK-DESCRIPTION]
```

6. Optional you can create a **Pull request** message using cursor. By this you can use the following prompt on cursor:

```bash
Cursor creame una descripcion de un pr siguiendo las instrucciones en @pr-generator
```

`Cursor` must be provided a **Pull request** message on markdown. If only provide this one on console please ask for a
markdown format message.

7. Create a **pull request** to the **develop** branch and assign a **reviewer** at least before merging the **feature
   branch** and use as a message the **pr message** generated by cursor.

8. After the **pull request** is merged using **rebase with fast forward strategy**, the **feature branch** must be
   deleted from remote repository using the following command:

```bash
git push origin --delete [FEATURE_TYPE]/[PROYECT_CODE]-[TASK_ID]-[TASK-DESCRIPTION]
```

9. Move to the **develop** branch and update it:

```bash
git checkout develop
```

```bash
git pull origin develop --rebase
```

10. Optional delete on **local repository** the feature branch:

```bash
git branch -D [FEATURE_TYPE]/[PROYECT_CODE]-[TASK_ID]-[TASK-DESCRIPTION]
```

## Git workflow develop into staging

6. Create a **pull request** from **develop** branch into **staging** and assign a **reviewer** at least before merging.

7. After the **pull request** is merged using **merge strategy**, on local repository move to **staging** and update it:

```bash
git checkout staging
```

```bash
git pull origin staging --rebase
```

## Git workflow release

1. On local repository move into **staging** branch and update it:

```bash
git checkout staging
```

```bash
git pull origin staging --rebase
```

2. Create a new **release branch** taking as base **staging** using the following naming convention where version is the
   next **version** to release:

```bash
git checkout -b release/vx.x.x
```

3. Update for a next version using `Changeset`, for this we need to create a new version:

```bash
pnpm changeset add
```

We need to choose the type of release to create a digit to elevate for the version the which can be the followings:

- **patch**: x.x.[x]
- **minor**: x.[x].x
- **major**: [x].x.x

and create a confirm message. For confirm message use the following convention:

```bash
Release vx.x.x
```

4. To apply a new version run the following command:

```bash
pnpm changeset version
```

`Version` on **package.json** should be updated automatically.

5. Go to **CHANGELOG.md** and you can see a new register for a new version. Down on this we can add the commits lists
   included on this release as follow:

```bash
### Patch Changes

- Release v0.0.3

### Commits

1. **feature** - gui 25 componente brand
2. **feature** - gui 40 componente text
3. **feature** - gui 23 componente button
4. **refactor** - gui 39 definir las variables de los themes del design system
5. **feature** - definir los tokens o variables en cada theme
6. **feature** - gui 39 definir las variables de los themes del design system
7. **cicd** - gui 18 configurar pipeline de building y subida de paquete a gitlab
8. **bugfix** - reparar sintaxis del pipeline de desarrollo
9. **bugfix** - update pipelines
10. **bugfix** - test pipeline
11. **cicd** - gui 17 configurar pipeline para aplicar linting y comprobaciones en desarrollo

**Total commits**: 11
```

6. Add changes and commit:

```bash
git add .
```

```bash
git commit -m "release/vx.x.x"
```

7. Push the release branch:

```bash
git push origin release/vx.x.x
```

8. Create a new **tag** for this release and push it:

```bash
git tag -a vx.x.x -m "Release vx.x.x"
```

```bash
git push origin vx.x.x
```

9. Go to **remote repository** and create a new **pull request** from the **release** branch into **main**. Assign a
   **reviewer** at least before merging.

10. After merge the **release branch**, delete release branch on remote repository:

```bash
git push origin --delete release/vx.x.x
```

11. On local repository move to **main** and update it:

```bash
git checkout main
```

```bash
git pull origin main --rebase
```

12. Optional delete a **release** branch:

```bash
git branch -D release/vx.x.x
```

13. Move and update **staging** respect to **remote main**:

```bash
git checkout staging
```

```bash
git pull origin main --rebase
```

14. Finally move and update **develop** respect to **remote main**:

```bash
git checkout develop
```

```bash
git pull origin main --rebase
```
